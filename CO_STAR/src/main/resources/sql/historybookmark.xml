<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="Historybookmark">
	<resultMap type="HistoryBookmarkVO" id="historybookmarkMap">
		<result property="concertVO.concertId" column="concertId"/>
		<result property="memberVO.memberId" column="memberId"/>
		<result property="historyBookmarkIsBookmark" column="historyBookmarkIsBookmark"/>
	</resultMap>
	
	
	<insert id="addHistory" parameterType="historyBookmarkVO">
		INSERT INTO HistoryBookmark VALUES(
			#{concertVO.concertId},
			#{memberVO.memberId},
			#{historyBookmarkIsBookmark}
		)
	</insert>
	
	<delete id="deleteBookmark" parameterType="historyBookmarkVO">
		DELETE FROM HistoryBookmark WHERE
		concertId=#{concertVO.concertId} AND memberId=#{memberVO.memberId}
	</delete>
	
	<update id="updateBookmark" parameterType="historyBookmarkVO">
		UPDATE HistoryBookmark 
		SET historyBookmarkIsBookmark = #{historyBookmarkIsBookmark}
		WHERE concertId=#{concertVO.concertId} AND memberId=#{memberVO.memberId}
	</update>
	
	
	<!-- 히스토리 보기 -->
	<select id="showHistory" parameterType="string" resultType="concertVO">
		SELECT * FROM concert 
		WHERE concertId=(SELECT concertId FROM HistoryBookmark WHERE memberId=#{value}
		AND historyBookmarkIsBookmark=0)
	</select>
	
	
	<!-- 북마크 보기 -->
	<select id="showBookmark" parameterType="string" resultType="concertVO">
		SELECT * FROM concert
		WHERE concertId=
			(SELECT concertId FROM HistoryBookmark 
			WHERE memberId=#{value}
			AND historyBookmarkIsBookmark=1)
	</select>
	
	
	<!-- 히스토리 + 북마크 -->
	<select id="showHistoryBookmark" resultMap="historybookmarkMap">
		SELECT * FROM HistoryBookmark
	</select>		
	

</mapper>

